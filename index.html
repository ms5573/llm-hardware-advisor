<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LLM Hardware Picker — Find the Perfect Hardware for Local AI</title>
<meta name="description" content="Interactive explorer mapping LLM models to the hardware that runs them best. Find your perfect local AI setup.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#08080d;--bg2:#0e0e18;--bg-card:rgba(14,14,26,0.88);--bg-card-hover:rgba(22,22,42,0.95);
  --border:rgba(255,255,255,0.06);--border-h:rgba(255,255,255,0.12);
  --text:#e8e8f0;--text-dim:#8888a8;--text-muted:#555570;
  --accent:#7c6aff;--accent-glow:rgba(124,106,255,0.25);
  --coding:#22d3ee;--reasoning:#f472b6;--chat:#34d399;--multimodal:#fb923c;--embedding:#a78bfa;--general:#60a5fa;
  --amazon:#ff9900;--amazon-hover:#ffad33;
  --fit-perfect:#22c55e;--fit-good:#3b82f6;--fit-marginal:#f59e0b;--fit-tight:#ef4444;
}
body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;height:100vh;width:100vw}
#canvas-container{position:absolute;inset:0;z-index:1}
svg{display:block}

.bg-grad{position:fixed;inset:0;z-index:0;background:
  radial-gradient(ellipse 80% 60% at 50% 45%,rgba(124,106,255,0.05) 0%,transparent 60%),
  radial-gradient(ellipse 50% 40% at 20% 80%,rgba(34,211,238,0.03) 0%,transparent 50%),
  radial-gradient(ellipse 50% 40% at 80% 20%,rgba(244,114,182,0.03) 0%,transparent 50%),
  var(--bg)}

/* Header */
.header{position:fixed;top:0;left:0;right:0;z-index:100;padding:16px 28px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,rgba(8,8,13,0.97) 0%,rgba(8,8,13,0) 100%);pointer-events:none}
.header>*{pointer-events:auto}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:34px;height:34px;background:linear-gradient(135deg,var(--accent),var(--coding));border-radius:9px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;color:#fff;box-shadow:0 0 20px var(--accent-glow)}
.logo-text{font-size:17px;font-weight:700;letter-spacing:-0.5px}
.logo-text span{color:var(--text-dim);font-weight:400;font-size:14px}

.controls{display:flex;gap:8px;align-items:center}
.btn{background:var(--bg-card);border:1px solid var(--border);color:var(--text);padding:7px 14px;border-radius:8px;font-family:inherit;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s;backdrop-filter:blur(12px);display:flex;align-items:center;gap:5px}
.btn:hover{background:var(--bg-card-hover);border-color:var(--border-h)}
.btn svg{width:13px;height:13px}

.search-box{position:relative}
.search-box input{background:var(--bg-card);border:1px solid var(--border);color:var(--text);padding:7px 12px 7px 32px;border-radius:8px;font-family:inherit;font-size:12px;width:200px;outline:none;transition:all .2s;backdrop-filter:blur(12px)}
.search-box input::placeholder{color:var(--text-muted)}
.search-box input:focus{border-color:rgba(124,106,255,0.4);box-shadow:0 0 0 3px rgba(124,106,255,0.08);width:260px}
.search-box svg{position:absolute;left:9px;top:50%;transform:translateY(-50%);color:var(--text-muted);pointer-events:none}

/* Breadcrumb */
.breadcrumb{position:fixed;top:60px;left:28px;z-index:100;display:flex;align-items:center;gap:6px;font-size:12px;color:var(--text-dim)}
.bc-item{cursor:pointer;padding:3px 9px;border-radius:5px;transition:all .2s}
.bc-item:hover{background:rgba(255,255,255,0.05);color:var(--text)}
.bc-item.cur{color:var(--text);font-weight:500}
.bc-sep{color:var(--text-muted);font-size:10px}

/* Detail Panel */
.panel{position:fixed;right:20px;top:50%;transform:translateY(-50%) translateX(120%);z-index:200;width:370px;max-height:80vh;background:var(--bg-card);border:1px solid var(--border);border-radius:16px;backdrop-filter:blur(24px);overflow-y:auto;transition:transform .4s cubic-bezier(.16,1,.3,1);box-shadow:0 24px 80px rgba(0,0,0,0.5)}
.panel.open{transform:translateY(-50%) translateX(0)}
.panel::-webkit-scrollbar{width:4px}
.panel::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.08);border-radius:4px}
.panel-head{padding:20px 22px 14px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg-card);backdrop-filter:blur(24px);z-index:1}
.panel-close{position:absolute;top:14px;right:14px;width:26px;height:26px;border:none;background:rgba(255,255,255,0.05);border-radius:6px;color:var(--text-dim);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:15px;transition:all .2s}
.panel-close:hover{background:rgba(255,255,255,0.1);color:var(--text)}
.panel-cat{font-size:10px;font-weight:600;letter-spacing:1px;text-transform:uppercase;margin-bottom:4px}
.panel-title{font-size:18px;font-weight:700;letter-spacing:-0.3px;line-height:1.3}
.panel-body{padding:14px 22px 22px}

.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px}
.stat-card{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:9px;padding:10px}
.stat-label{font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:.7px;color:var(--text-muted);margin-bottom:3px}
.stat-val{font-size:16px;font-weight:700;font-family:'JetBrains Mono',monospace}
.stat-unit{font-size:10px;color:var(--text-dim);font-weight:400}

.sec-title{font-size:10px;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--text-muted);margin:14px 0 8px}

.tag-list{display:flex;flex-wrap:wrap;gap:5px}
.tag{padding:3px 9px;border-radius:5px;font-size:10px;font-weight:500;background:rgba(255,255,255,0.04);border:1px solid var(--border);color:var(--text-dim)}

.model-list{display:flex;flex-direction:column;gap:5px}
.model-item{padding:9px 11px;border-radius:7px;background:rgba(255,255,255,0.02);border:1px solid var(--border);cursor:pointer;transition:all .2s;display:flex;justify-content:space-between;align-items:center}
.model-item:hover{background:rgba(255,255,255,0.04);border-color:var(--border-h)}
.model-item-name{font-size:11px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px}
.model-item-meta{font-size:10px;font-family:'JetBrains Mono',monospace;color:var(--text-dim)}

.fit-bar{height:5px;border-radius:3px;background:rgba(255,255,255,0.04);margin-top:6px;overflow:hidden}
.fit-bar-in{height:100%;border-radius:3px;transition:width .6s cubic-bezier(.16,1,.3,1)}

/* Amazon CTA */
.amazon-btn{display:flex;align-items:center;justify-content:center;gap:8px;width:100%;padding:12px 16px;border-radius:10px;border:none;background:linear-gradient(135deg,#ff9900,#ffad33);color:#111;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;text-decoration:none;margin:14px 0 6px;box-shadow:0 4px 20px rgba(255,153,0,0.2)}
.amazon-btn:hover{transform:translateY(-1px);box-shadow:0 6px 28px rgba(255,153,0,0.35)}
.amazon-btn svg{width:16px;height:16px}
.amazon-sub{text-align:center;font-size:10px;color:var(--text-muted);margin-bottom:10px}

/* Tooltip */
.tip{position:fixed;z-index:999;pointer-events:none;background:rgba(14,14,26,0.95);border:1px solid rgba(255,255,255,0.1);border-radius:9px;padding:10px 14px;backdrop-filter:blur(16px);box-shadow:0 8px 28px rgba(0,0,0,0.4);font-size:11px;max-width:240px;opacity:0;transition:opacity .15s}
.tip.on{opacity:1}
.tip-t{font-weight:600;margin-bottom:3px}
.tip-s{color:var(--text-dim);font-size:10px}

/* Legend */
.legend{position:fixed;bottom:20px;left:28px;z-index:100;display:flex;gap:14px;padding:10px 16px;background:var(--bg-card);border:1px solid var(--border);border-radius:10px;backdrop-filter:blur(12px);font-size:10px;color:var(--text-dim);flex-wrap:wrap}
.leg-i{display:flex;align-items:center;gap:5px}
.leg-d{width:7px;height:7px;border-radius:50%}

/* Stats */
.stats{position:fixed;bottom:20px;right:20px;z-index:100;display:flex;gap:18px;padding:10px 16px;background:var(--bg-card);border:1px solid var(--border);border-radius:10px;backdrop-filter:blur(12px);font-size:10px}
.stats-n{font-family:'JetBrains Mono',monospace;font-weight:600;font-size:13px;color:var(--accent)}
.stats-l{color:var(--text-dim)}

/* Footer */
.footer{position:fixed;bottom:52px;left:50%;transform:translateX(-50%);z-index:100;font-size:9px;color:var(--text-muted);text-align:center;padding:4px 12px;background:var(--bg-card);border:1px solid var(--border);border-radius:6px;backdrop-filter:blur(12px);white-space:nowrap}

/* Animations */
@keyframes float-in{from{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}
.node-enter{animation:float-in .5s cubic-bezier(.16,1,.3,1) backwards}

/* Price badge */
.price-badge{display:inline-block;padding:3px 8px;border-radius:5px;font-size:11px;font-weight:600;font-family:'JetBrains Mono',monospace;background:rgba(255,153,0,0.1);color:var(--amazon);border:1px solid rgba(255,153,0,0.2)}
</style>
</head>
<body>
<div class="bg-grad"></div>

<div class="header">
  <div class="logo">
    <div class="logo-icon">LP</div>
    <div class="logo-text">LLM Picker <span>· Hardware Explorer</span></div>
  </div>
  <div class="controls">
    <div class="search-box">
      <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" placeholder="Search models, hardware..." id="searchInput">
    </div>
    <button class="btn" id="btnReset">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
      Reset
    </button>
  </div>
</div>

<div class="breadcrumb" id="breadcrumb">
  <div class="bc-item cur" data-level="root">Overview</div>
</div>

<div id="canvas-container"></div>

<div class="panel" id="panel">
  <div class="panel-head">
    <button class="panel-close" id="panelClose">&times;</button>
    <div class="panel-cat" id="pCat"></div>
    <div class="panel-title" id="pTitle"></div>
  </div>
  <div class="panel-body" id="pBody"></div>
</div>

<div class="tip" id="tip">
  <div class="tip-t" id="tipT"></div>
  <div class="tip-s" id="tipS"></div>
</div>

<div class="legend">
  <div class="leg-i"><div class="leg-d" style="background:var(--coding)"></div>Coding</div>
  <div class="leg-i"><div class="leg-d" style="background:var(--chat)"></div>Chat</div>
  <div class="leg-i"><div class="leg-d" style="background:var(--reasoning)"></div>Reasoning</div>
  <div class="leg-i"><div class="leg-d" style="background:var(--multimodal)"></div>Agents</div>
  <div class="leg-i"><div class="leg-d" style="background:var(--general)"></div>General</div>
  <div class="leg-i"><div class="leg-d" style="background:var(--amazon)"></div>Hardware</div>
</div>

<div class="stats">
  <div><div class="stats-n">497</div><div class="stats-l">Models</div></div>
  <div><div class="stats-n">11</div><div class="stats-l">Hardware</div></div>
  <div><div class="stats-n">4</div><div class="stats-l">Use Cases</div></div>
</div>

<div class="footer">Affiliate links support this project at no extra cost to you. Data via <a href="https://github.com/AlexsJones/llmfit" style="color:var(--accent);text-decoration:none">llmfit</a> (497 models scored).</div>

<script>
// ═══════════════════════════════════════════════════════════════════════════════
// DATA
// ═══════════════════════════════════════════════════════════════════════════════

const USE_CASES = [
  { id:'coding', label:'Coding', color:'#22d3ee', icon:'\u{1F4BB}', desc:'Code generation, completion, debugging, and refactoring with local LLMs.' },
  { id:'chat', label:'Chat & Assistant', color:'#34d399', icon:'\u{1F4AC}', desc:'Conversational AI, personal assistants, and instruction following.' },
  { id:'reasoning', label:'Reasoning', color:'#f472b6', icon:'\u{1F9E0}', desc:'Advanced reasoning, chain-of-thought, research, and step-by-step problem solving.' },
  { id:'agents', label:'Agents & Automation', color:'#fb923c', icon:'\u{1F916}', desc:'Autonomous agents, tool use, workflow automation, and agentic coding.' },
];

// All hardware with EXACT Amazon affiliate links (tag=ms5573-20)
const HARDWARE = [
  {
    id:'mac_mini_m4_16', label:'Mac Mini M4 16GB', price:'$499', tier:'Budget',
    mem:16, backend:'Apple Metal', desc:'Apple M4 chip with 16GB unified memory. Great entry point for local AI.',
    amazon:'https://www.amazon.com/Apple-2024-Desktop-Computer-10%E2%80%91core/dp/B0DLBTPDCS?tag=ms5573-20',
    color:'#a8a8a8', total:266,
    models:{
      coding:[
        {name:'Qwen2.5-Coder-7B',params:'7B',ram:7.1,fit:95,toks:18},
        {name:'DeepSeek-Coder-V2-Lite',params:'16B',ram:14.6,fit:72,toks:8},
        {name:'Qwen2.5-Coder-1.5B',params:'1.5B',ram:2.0,fit:88,toks:35}
      ],
      chat:[
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:95,toks:18},
        {name:'Mistral-7B-v0.2',params:'7B',ram:6.7,fit:96,toks:20},
        {name:'Llama-3.2-3B',params:'3B',ram:3.0,fit:88,toks:30}
      ],
      reasoning:[
        {name:'DeepSeek-R1-Distill-Qwen-14B',params:'14B',ram:13.8,fit:68,toks:6},
        {name:'DeepSeek-R1-Distill-Qwen-7B',params:'7B',ram:7.1,fit:95,toks:18},
        {name:'DeepSeek-R1-0528-Qwen3-8B',params:'8B',ram:7.6,fit:93,toks:16}
      ],
      agents:[
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:95,toks:18},
        {name:'Mistral-7B-v0.2',params:'7B',ram:6.7,fit:96,toks:20},
        {name:'Phi-3.5-Mini',params:'3.8B',ram:3.5,fit:88,toks:28}
      ]
    }
  },
  {
    id:'rtx4060ti', label:'RTX 4060 Ti 16GB', price:'$449', tier:'Budget',
    mem:16, backend:'NVIDIA CUDA', desc:'ZOTAC RTX 4060 Ti 16GB. Fast inference with CUDA acceleration.',
    amazon:'https://www.amazon.com/ZOTAC-Graphics-IceStorm-Advanced-ZT-D40620F-10M/dp/B0CMJQZQC6?tag=ms5573-20',
    color:'#76b900', total:304,
    models:{
      coding:[
        {name:'Qwen2.5-Coder-7B',params:'7B',ram:7.1,fit:95,toks:55},
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:72,toks:25},
        {name:'DeepSeek-Coder-V2-Lite',params:'16B',ram:14.6,fit:68,toks:20}
      ],
      chat:[
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:95,toks:55},
        {name:'Mistral-7B-v0.2',params:'7B',ram:6.7,fit:96,toks:60},
        {name:'Meta-Llama-3-8B',params:'8B',ram:7.6,fit:93,toks:50}
      ],
      reasoning:[
        {name:'DeepSeek-R1-Distill-Qwen-14B',params:'14B',ram:13.8,fit:72,toks:22},
        {name:'DeepSeek-R1-Distill-Qwen-7B',params:'7B',ram:7.1,fit:95,toks:55},
        {name:'DeepSeek-R1-0528-Qwen3-8B',params:'8B',ram:7.6,fit:93,toks:48}
      ],
      agents:[
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:95,toks:55},
        {name:'Mistral-7B-v0.2',params:'7B',ram:6.7,fit:96,toks:60},
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:72,toks:25}
      ]
    }
  },
  {
    id:'mac_mini_m4pro_24', label:'Mac Mini M4 Pro 24GB', price:'$1,399', tier:'Mid-Range',
    mem:24, backend:'Apple Metal', desc:'Apple M4 Pro with 24GB unified memory. Runs most 14B models comfortably.',
    amazon:'https://www.amazon.com/Apple-Desktop-Computer-12%E2%80%91core-16%E2%80%91core/dp/B0DLBVHSLD?tag=ms5573-20',
    color:'#a8a8a8', total:285,
    models:{
      coding:[
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:92,toks:22},
        {name:'Qwen2.5-Coder-7B',params:'7B',ram:7.1,fit:98,toks:28},
        {name:'Devstral-Small-2507',params:'24B',ram:22.0,fit:72,toks:8}
      ],
      chat:[
        {name:'Mistral-Small-24B',params:'24B',ram:22.0,fit:72,toks:8},
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:98,toks:28},
        {name:'Llama-3.2-11B',params:'11B',ram:10.2,fit:95,toks:18}
      ],
      reasoning:[
        {name:'DeepSeek-R1-Distill-Qwen-14B',params:'14B',ram:13.8,fit:92,toks:16},
        {name:'DeepSeek-R1-0528-Qwen3-8B',params:'8B',ram:7.6,fit:98,toks:26},
        {name:'DeepSeek-R1-Distill-Qwen-7B',params:'7B',ram:7.1,fit:98,toks:28}
      ],
      agents:[
        {name:'Mistral-Small-24B',params:'24B',ram:22.0,fit:72,toks:8},
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:98,toks:28},
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:92,toks:22}
      ]
    }
  },
  {
    id:'rtx4090', label:'RTX 4090 24GB', price:'$1,999', tier:'Mid-Range',
    mem:24, backend:'NVIDIA CUDA', desc:'ASUS TUF RTX 4090 24GB. Flagship consumer GPU with blazing inference speed.',
    amazon:'https://www.amazon.com/ASUS-GeForce-Graphics-DisplayPort-TUF-RTX4090-O24G-GAMING/dp/B0BGV6LQYR?tag=ms5573-20',
    color:'#76b900', total:337,
    models:{
      coding:[
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:65,toks:35},
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:95,toks:50},
        {name:'Qwen2.5-Coder-7B',params:'7B',ram:7.1,fit:98,toks:80}
      ],
      chat:[
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:98,toks:80},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:65,toks:18},
        {name:'Mistral-7B-v0.2',params:'7B',ram:6.7,fit:98,toks:85}
      ],
      reasoning:[
        {name:'DeepSeek-R1-Distill-Qwen-32B',params:'32B',ram:30.4,fit:62,toks:30},
        {name:'DeepSeek-R1-Distill-Qwen-14B',params:'14B',ram:13.8,fit:95,toks:45},
        {name:'DeepSeek-R1-Distill-Qwen-7B',params:'7B',ram:7.1,fit:98,toks:80}
      ],
      agents:[
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:65,toks:35},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:65,toks:18},
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:98,toks:80}
      ]
    }
  },
  {
    id:'mac_studio_m4max_64', label:'Mac Studio M4 Max 64GB', price:'$3,199', tier:'Serious',
    mem:64, backend:'Apple Metal', desc:'Apple M4 Max with 64GB unified memory. Run 32B+ models with room to spare.',
    amazon:'https://www.amazon.com/Apple-Studio-16-Core-40-Core-Unified/dp/B0FNS1ZX5B?tag=ms5573-20',
    color:'#a8a8a8', total:340,
    models:{
      coding:[
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:88,toks:10},
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:98,toks:22},
        {name:'Qwen2.5-Coder-7B',params:'7B',ram:7.1,fit:100,toks:30}
      ],
      chat:[
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:78,toks:6},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:80,toks:8},
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:100,toks:30}
      ],
      reasoning:[
        {name:'DeepSeek-R1-Distill-Qwen-32B',params:'32B',ram:30.4,fit:88,toks:8},
        {name:'DeepSeek-R1-Distill-Qwen-14B',params:'14B',ram:13.8,fit:98,toks:22},
        {name:'DeepSeek-R1-Distill-Qwen-7B',params:'7B',ram:7.1,fit:100,toks:30}
      ],
      agents:[
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:78,toks:6},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:88,toks:10},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:80,toks:8}
      ]
    }
  },
  {
    id:'mac_studio_m4max_128', label:'Mac Studio M4 Max 128GB', price:'$3,599', tier:'Serious',
    mem:128, backend:'Apple Metal', desc:'Apple M4 Max with 128GB unified memory. Run 70B+ models natively on Apple Silicon with massive headroom.',
    amazon:'https://www.amazon.com/Apple-Studio-16-Core-40-Core-Unified/dp/B0FMFZ5SXS?tag=ms5573-20',
    color:'#a8a8a8', total:365,
    models:{
      coding:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:88,toks:5},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:98,toks:12},
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:100,toks:24}
      ],
      chat:[
        {name:'Qwen1.5-110B-Chat',params:'110B',ram:103.6,fit:72,toks:2},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:92,toks:7},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:92,toks:9}
      ],
      reasoning:[
        {name:'Qwen3-Next-80B-A3B',params:'80B',ram:75.7,fit:82,toks:4},
        {name:'DeepSeek-R1-Distill-Qwen-32B',params:'32B',ram:30.4,fit:98,toks:12},
        {name:'DeepSeek-R1-Distill-Qwen-14B',params:'14B',ram:13.8,fit:100,toks:24}
      ],
      agents:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:88,toks:5},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:92,toks:7},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:98,toks:12}
      ]
    }
  },
  {
    id:'mac_studio_m3ultra_96', label:'Mac Studio M3 Ultra 96GB', price:'$3,999', tier:'Serious',
    mem:96, backend:'Apple Metal', desc:'Apple M3 Ultra with 96GB unified memory, 60-core GPU. Dual-die powerhouse for serious local AI workloads.',
    amazon:'https://www.amazon.com/Apple-Desktop-Computer-28-Core-60-Core/dp/B0FHMN84YC?tag=ms5573-20',
    color:'#a8a8a8', total:350,
    models:{
      coding:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:78,toks:4},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:96,toks:10},
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:100,toks:20}
      ],
      chat:[
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:88,toks:6},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:90,toks:8},
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:100,toks:28}
      ],
      reasoning:[
        {name:'DeepSeek-R1-Distill-Qwen-32B',params:'32B',ram:30.4,fit:96,toks:10},
        {name:'DeepSeek-R1-Distill-Qwen-14B',params:'14B',ram:13.8,fit:100,toks:20},
        {name:'DeepSeek-R1-Distill-Qwen-7B',params:'7B',ram:7.1,fit:100,toks:28}
      ],
      agents:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:78,toks:4},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:88,toks:6},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:96,toks:10}
      ]
    }
  },
  {
    id:'mac_studio_m3ultra_256', label:'Mac Studio M3 Ultra 256GB', price:'$5,999', tier:'All-In',
    mem:256, backend:'Apple Metal', desc:'Apple M3 Ultra with 256GB unified memory and 60-core GPU. Run massive 100B+ parameter models entirely in memory.',
    amazon:'https://www.amazon.com/Apple-Studio-28-Core-60-Core-Unified/dp/B0FM5CSC4P?tag=ms5573-20',
    color:'#a8a8a8', total:395, featured:true,
    models:{
      coding:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:100,toks:8},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:100,toks:18},
        {name:'Qwen3-Coder-30B-A3B',params:'30B',ram:28.5,fit:100,toks:20}
      ],
      chat:[
        {name:'Qwen1.5-110B-Chat',params:'110B',ram:103.6,fit:90,toks:3},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:100,toks:12},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:100,toks:14}
      ],
      reasoning:[
        {name:'GPT-OSS-120B',params:'120B',ram:108.8,fit:85,toks:3},
        {name:'Qwen3-Next-80B-A3B',params:'80B',ram:75.7,fit:96,toks:6},
        {name:'DeepSeek-R1-Distill-Qwen-32B',params:'32B',ram:30.4,fit:100,toks:18}
      ],
      agents:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:100,toks:8},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:100,toks:12},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:100,toks:18}
      ]
    }
  },
  {
    id:'rtx4090_64ram', label:'RTX 4090 + 64GB RAM', price:'$2,800', tier:'Serious',
    mem:24, backend:'NVIDIA CUDA', desc:'RTX 4090 in a 64GB RAM workstation. GPU for speed, CPU offload for big models.',
    amazon:'https://www.amazon.com/ASUS-GeForce-Graphics-DisplayPort-TUF-RTX4090-O24G-GAMING/dp/B0BGV6LQYR?tag=ms5573-20',
    color:'#76b900', total:337,
    models:{
      coding:[
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:65,toks:35},
        {name:'Qwen3-Coder-Next Q4',params:'14B',ram:13.5,fit:95,toks:50},
        {name:'Qwen2.5-Coder-7B',params:'7B',ram:7.1,fit:98,toks:80}
      ],
      chat:[
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:98,toks:80},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:65,toks:18},
        {name:'Mistral-7B-v0.2',params:'7B',ram:6.7,fit:98,toks:85}
      ],
      reasoning:[
        {name:'DeepSeek-R1-Distill-Qwen-32B',params:'32B',ram:30.4,fit:62,toks:30},
        {name:'DeepSeek-R1-Distill-Qwen-14B',params:'14B',ram:13.8,fit:95,toks:45},
        {name:'DeepSeek-R1-Distill-Qwen-7B',params:'7B',ram:7.1,fit:98,toks:80}
      ],
      agents:[
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:65,toks:35},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:65,toks:18},
        {name:'Qwen2.5-7B',params:'7B',ram:7.1,fit:98,toks:80}
      ]
    }
  },
  {
    id:'dgx_spark', label:'NVIDIA DGX Spark 128GB', price:'$3,999', tier:'All-In',
    mem:128, backend:'NVIDIA Grace Blackwell', desc:'NVIDIA DGX Spark with 128GB unified memory and Blackwell GPU. The ultimate local AI powerhouse \u2014 runs 100B+ models.',
    amazon:'https://www.amazon.com/NVIDIA-DGX-SparkTM-Supercomputer-Blackwell/dp/B0FWJ16CCH?tag=ms5573-20',
    color:'#76b900', total:367, featured:true,
    models:{
      coding:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:92,toks:12},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:98,toks:30},
        {name:'Qwen3-Coder-30B-A3B',params:'30B',ram:28.5,fit:98,toks:32}
      ],
      chat:[
        {name:'Qwen1.5-110B-Chat',params:'110B',ram:103.6,fit:72,toks:4},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:96,toks:14},
        {name:'Mixtral-8x7B',params:'8x7B',ram:43.5,fit:96,toks:18}
      ],
      reasoning:[
        {name:'GPT-OSS-120B',params:'120B',ram:108.8,fit:68,toks:4},
        {name:'Qwen3-Next-80B-A3B',params:'80B',ram:75.7,fit:90,toks:10},
        {name:'DeepSeek-R1-Distill-Qwen-32B',params:'32B',ram:30.4,fit:98,toks:30}
      ],
      agents:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:92,toks:12},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:96,toks:14},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:98,toks:30}
      ]
    }
  },
  {
    id:'dgx_spark_x2', label:'2x DGX Spark + NVLink', price:'$8,998', tier:'All-In',
    mem:256, backend:'NVIDIA Grace Blackwell', desc:'Two DGX Sparks connected via NVLink for 256GB unified memory. Run the largest open-source models locally.',
    amazon:'https://www.amazon.com/NVIDIA-DGX-SparkTM-Supercomputer-Blackwell/dp/B0FWJ16CCH?tag=ms5573-20',
    color:'#76b900', total:400,
    models:{
      coding:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:100,toks:25},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:100,toks:55},
        {name:'Qwen3-Coder-30B-A3B',params:'30B',ram:28.5,fit:100,toks:58}
      ],
      chat:[
        {name:'DeepSeek-V3.2 671B MoE',params:'671B',ram:638.3,fit:55,toks:2},
        {name:'Qwen1.5-110B-Chat',params:'110B',ram:103.6,fit:95,toks:10},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:100,toks:28}
      ],
      reasoning:[
        {name:'GPT-OSS-120B',params:'120B',ram:108.8,fit:92,toks:10},
        {name:'Qwen3-Next-80B-A3B',params:'80B',ram:75.7,fit:98,toks:20},
        {name:'DeepSeek-R1-Distill-Qwen-32B',params:'32B',ram:30.4,fit:100,toks:55}
      ],
      agents:[
        {name:'Qwen3-Coder-Next (full)',params:'72B',ram:74.2,fit:100,toks:25},
        {name:'Llama-3.3-Nemotron-Super-49B',params:'49B',ram:46.4,fit:100,toks:28},
        {name:'Qwen2.5-Coder-32B',params:'32B',ram:30.4,fit:100,toks:55}
      ]
    }
  }
];

// Accessory
const ACCESSORIES = [
  { label:'Samsung T9 2TB SSD', desc:'Fast external storage for model files', price:'$149',
    amazon:'https://www.amazon.com/SAMSUNG-Portable-Professionals-MU-PG2T0B-AM/dp/B0CHFS9K14?tag=ms5573-20' }
];

// Flatten all unique models for search
const ALL_MODELS = [];
const seen = new Set();
HARDWARE.forEach(hw => {
  Object.values(hw.models).forEach(arr => {
    arr.forEach(m => {
      if (!seen.has(m.name)) { seen.add(m.name); ALL_MODELS.push(m); }
    });
  });
});

// ═══════════════════════════════════════════════════════════════════════════════
// VIS ENGINE
// ═══════════════════════════════════════════════════════════════════════════════
const W = window.innerWidth, H = window.innerHeight;
let curView = 'overview', curUC = null;

const svg = d3.select('#canvas-container').append('svg').attr('width',W).attr('height',H);
const defs = svg.append('defs');

// Filters
const glow = defs.append('filter').attr('id','glow');
glow.append('feGaussianBlur').attr('stdDeviation','4').attr('result','b');
const fm = glow.append('feMerge'); fm.append('feMergeNode').attr('in','b'); fm.append('feMergeNode').attr('in','SourceGraphic');

// Gradients
const cgrad = defs.append('radialGradient').attr('id','cg');
cgrad.append('stop').attr('offset','0%').attr('stop-color','#7c6aff').attr('stop-opacity',.7);
cgrad.append('stop').attr('offset','100%').attr('stop-color','#7c6aff').attr('stop-opacity',.05);

USE_CASES.forEach(uc => {
  const g = defs.append('radialGradient').attr('id','g-'+uc.id);
  g.append('stop').attr('offset','0%').attr('stop-color',uc.color).attr('stop-opacity',.5);
  g.append('stop').attr('offset','100%').attr('stop-color',uc.color).attr('stop-opacity',.03);
});

const G = svg.append('g');
const zoom = d3.zoom().scaleExtent([.25,4]).on('zoom',e => G.attr('transform',e.transform));
svg.call(zoom);

// Tooltip
const tip = d3.select('#tip');
function showTip(ev,t,s){ tip.select('#tipT').text(t); tip.select('#tipS').text(s); tip.classed('on',true).style('left',(ev.clientX+14)+'px').style('top',(ev.clientY-8)+'px'); }
function moveTip(ev){ tip.style('left',(ev.clientX+14)+'px').style('top',(ev.clientY-8)+'px'); }
function hideTip(){ tip.classed('on',false); }

// Panel
const panel = d3.select('#panel');
d3.select('#panelClose').on('click',()=>panel.classed('open',false));

// ═══════════════════════════════════════════════════════════════════════════════
// AMAZON BUTTON HTML
// ═══════════════════════════════════════════════════════════════════════════════
function amazonBtnHTML(url, label) {
  label = label || 'View on Amazon';
  return '<a href="'+url+'" target="_blank" rel="noopener" class="amazon-btn">' +
    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M1.5 21.15c4.16 2.07 8.6 3.14 13.34 2.28 2.4-.44 4.6-1.37 6.6-2.76.4-.28.76-.6.56-1.1-.2-.48-.72-.36-1.1-.16-3.2 1.7-6.6 2.5-10.24 2.22-3.16-.24-6.08-1.2-8.74-2.9-.3-.2-.56-.44-.9-.28-.4.2-.36.56.48.7zM21.5 19.5c-.38-.48-2.48-.6-3.44-.48-.28.04-.32.2-.08.36.48.32.96.56 1.48.68 1 .24 2.28.12 2.52-.08.24-.2 0-.96-.48-1.48z"/><path d="M14.25 3.75c0-1.06.04-1.94-.5-2.88-.44-.76-1.14-1.22-1.92-1.22-2.12 0-3.36 1.62-3.36 4.02 0 1.52.72 3.22 3.04 3.22.88 0 1.66-.34 2.2-1.06.66-.88.54-2.06.54-3.08zm2.08 7.14c-.14.16-.38.16-.56.08-.78-.66-.92-1.28-1.36-1.92-1.3 1.32-2.22 1.72-3.9 1.72-2 0-3.54-1.22-3.54-3.68 0-1.92 1.04-3.22 2.52-3.86 1.28-.56 3.06-.66 4.42-.82V2.1c0-.5.04-1.08-.26-1.5-.26-.38-.74-.54-1.18-.54-.8 0-1.52.42-1.7 1.28-.04.2-.18.38-.38.4L8.2 1.46c-.18-.04-.38-.18-.32-.44C8.48-1.4 10.72.08 12.86.08c1.1 0 2.54.3 3.4 1.12 1.1 1.04.98 2.42.98 3.92v3.56c0 1.06.44 1.54.86 2.12.14.2.18.46 0 .6-.44.38-1.24.72-1.68 1.04l-.09-.05z"/></svg>' +
    label + '</a>' +
    '<div class="amazon-sub">Affiliate link \u00B7 No extra cost to you</div>';
}

// ═══════════════════════════════════════════════════════════════════════════════
// PANEL RENDERERS
// ═══════════════════════════════════════════════════════════════════════════════
function showHWPanel(hw) {
  d3.select('#pCat').text('HARDWARE \u00B7 '+hw.tier).style('color',hw.color);
  d3.select('#pTitle').text(hw.label);

  var html = '<p style="color:var(--text-dim);font-size:12px;line-height:1.5;margin-bottom:12px">'+hw.desc+'</p>';
  html += '<div style="margin-bottom:14px"><span class="price-badge">'+hw.price+'</span></div>';
  html += '<div class="stat-grid">';
  html += '<div class="stat-card"><div class="stat-label">Memory</div><div class="stat-val">'+hw.mem+'<span class="stat-unit"> GB</span></div></div>';
  html += '<div class="stat-card"><div class="stat-label">Backend</div><div class="stat-val" style="font-size:11px;color:'+hw.color+'">'+hw.backend+'</div></div>';
  html += '<div class="stat-card"><div class="stat-label">Fits Models</div><div class="stat-val">'+hw.total+'</div></div>';
  html += '<div class="stat-card"><div class="stat-label">Tier</div><div class="stat-val" style="font-size:12px">'+hw.tier+'</div></div>';
  html += '</div>';
  html += amazonBtnHTML(hw.amazon);

  html += '<div class="sec-title">Top Models by Use Case</div>';
  USE_CASES.forEach(function(uc){
    var models = hw.models[uc.id] || [];
    if(!models.length) return;
    html += '<div style="margin-bottom:12px">';
    html += '<div style="font-size:11px;font-weight:600;color:'+uc.color+';margin-bottom:5px">'+uc.icon+' '+uc.label+'</div>';
    html += '<div class="model-list">';
    models.forEach(function(m){
      html += '<div class="model-item"><div><div class="model-item-name">'+m.name+'</div><div style="font-size:9px;color:var(--text-muted)">'+m.params+' \u00B7 '+m.ram+'GB \u00B7 Fit '+m.fit+'%</div></div><div class="model-item-meta">'+m.toks+' t/s</div></div>';
    });
    html += '</div></div>';
  });

  html += '<div class="sec-title">Recommended Accessory</div>';
  ACCESSORIES.forEach(function(a){
    html += '<div class="model-item" style="margin-bottom:4px"><div><div class="model-item-name">'+a.label+'</div><div style="font-size:9px;color:var(--text-muted)">'+a.desc+'</div></div><div class="model-item-meta">'+a.price+'</div></div>';
    html += '<a href="'+a.amazon+'" target="_blank" rel="noopener" style="display:block;text-align:center;color:var(--amazon);font-size:11px;text-decoration:none;padding:4px">View SSD on Amazon \u2192</a>';
  });

  d3.select('#pBody').html(html);
  panel.classed('open',true);
}

function showUCPanel(uc) {
  d3.select('#pCat').text('USE CASE').style('color',uc.color);
  d3.select('#pTitle').text(uc.label);

  var hwForUC = HARDWARE.filter(function(hw){ return (hw.models[uc.id]||[]).length > 0; });
  var html = '<p style="color:var(--text-dim);font-size:12px;line-height:1.5;margin-bottom:14px">'+uc.desc+'</p>';
  html += '<div class="stat-grid">';
  html += '<div class="stat-card"><div class="stat-label">Hardware Options</div><div class="stat-val">'+hwForUC.length+'</div></div>';
  html += '<div class="stat-card"><div class="stat-label">Best Budget</div><div class="stat-val" style="font-size:11px">'+(hwForUC[0]?hwForUC[0].label:'\u2014')+'</div></div>';
  html += '</div>';

  html += '<div class="sec-title">Hardware Recommendations</div>';
  hwForUC.forEach(function(hw){
    var models = hw.models[uc.id] || [];
    html += '<div style="margin-bottom:14px;padding:10px;background:rgba(255,255,255,0.02);border:1px solid var(--border);border-radius:8px">';
    html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><div><div style="font-size:12px;font-weight:600">'+hw.label+'</div><div style="font-size:10px;color:var(--text-dim)">'+hw.tier+' \u00B7 '+hw.mem+'GB</div></div><span class="price-badge">'+hw.price+'</span></div>';
    html += '<div class="model-list">';
    models.slice(0,2).forEach(function(m){
      html += '<div class="model-item"><div><div class="model-item-name">'+m.name+'</div><div style="font-size:9px;color:var(--text-muted)">'+m.params+' \u00B7 Fit '+m.fit+'%</div></div><div class="model-item-meta">'+m.toks+' t/s</div></div>';
    });
    html += '</div>';
    html += '<a href="'+hw.amazon+'" target="_blank" rel="noopener" style="display:block;text-align:center;color:var(--amazon);font-size:11px;font-weight:500;text-decoration:none;padding:8px 0 2px">View on Amazon \u2192</a>';
    html += '</div>';
  });

  d3.select('#pBody').html(html);
  panel.classed('open',true);
}

function showModelPanel(m, hw) {
  // Find all hardware that lists this model and get the best fit data per hardware
  var fitsOn = [];
  HARDWARE.forEach(function(h){
    var bestMatch = null;
    Object.values(h.models).forEach(function(arr){
      arr.forEach(function(x){
        if(x.name===m.name) {
          if(!bestMatch || x.fit > bestMatch.fit) bestMatch = x;
        }
      });
    });
    if(bestMatch) fitsOn.push({hw:h, match:bestMatch});
  });

  // Sort by price (cheapest first) — parse price string to number
  fitsOn.sort(function(a,b){
    var pa = parseFloat(a.hw.price.replace(/[$,]/g,''));
    var pb = parseFloat(b.hw.price.replace(/[$,]/g,''));
    return pa - pb;
  });

  // The cheapest option with fit >= 65 is the "best value" recommendation
  var bestIdx = 0;
  for(var i=0;i<fitsOn.length;i++){
    if(fitsOn[i].match.fit >= 65){ bestIdx = i; break; }
  }
  var best = fitsOn[bestIdx];

  d3.select('#pCat').text('MODEL').style('color','var(--accent)');
  d3.select('#pTitle').text(m.name);

  var fitColor = m.fit>=90?'var(--fit-perfect)':m.fit>=75?'var(--fit-good)':m.fit>=60?'var(--fit-marginal)':'var(--fit-tight)';
  var html = '<p style="color:var(--text-dim);font-size:12px;line-height:1.5;margin-bottom:14px">'+m.params+' parameters \u00B7 '+m.ram+'GB RAM required</p>';
  html += '<div class="stat-grid">';
  html += '<div class="stat-card"><div class="stat-label">Parameters</div><div class="stat-val">'+m.params+'</div></div>';
  html += '<div class="stat-card"><div class="stat-label">RAM Needed</div><div class="stat-val">'+m.ram+'<span class="stat-unit"> GB</span></div></div>';
  html += '<div class="stat-card"><div class="stat-label">Fit Score</div><div class="stat-val" style="color:'+fitColor+'">'+m.fit+'%</div></div>';
  html += '<div class="stat-card"><div class="stat-label">Speed</div><div class="stat-val">'+m.toks+'<span class="stat-unit"> t/s</span></div></div>';
  html += '</div>';

  // Best value recommendation
  if(best) {
    html += '<div class="sec-title">Best Value Hardware</div>';
    html += '<div style="padding:12px;background:rgba(34,197,94,0.06);border:1px solid rgba(34,197,94,0.2);border-radius:9px;margin-bottom:10px">';
    html += '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">';
    html += '<div><div style="font-size:13px;font-weight:600">'+best.hw.label+'</div>';
    html += '<div style="font-size:10px;color:var(--text-dim)">'+best.hw.mem+'GB \u00B7 '+best.match.toks+' t/s \u00B7 Fit '+best.match.fit+'%</div></div>';
    html += '<span class="price-badge">'+best.hw.price+'</span></div>';
    html += '<div style="font-size:10px;color:var(--fit-perfect);font-weight:500;margin-bottom:2px">\u2714 Cheapest option that runs this model comfortably</div>';
    html += '</div>';
    html += amazonBtnHTML(best.hw.amazon, 'Buy '+best.hw.label+' on Amazon');
  }

  // Other options (skip the best value one, show rest)
  var others = fitsOn.filter(function(_,i){ return i !== bestIdx; });
  if(others.length) {
    html += '<div class="sec-title">Also Runs On ('+others.length+' more)</div>';
    html += '<div class="model-list">';
    others.forEach(function(item){
      html += '<div class="model-item" onclick="window._showHW(\''+item.hw.id+'\')">';
      html += '<div><div class="model-item-name">'+item.hw.label+'</div>';
      html += '<div style="font-size:9px;color:var(--text-muted)">'+item.hw.mem+'GB \u00B7 '+item.match.toks+' t/s \u00B7 Fit '+item.match.fit+'%</div></div>';
      html += '<span class="price-badge" style="font-size:9px;padding:2px 6px">'+item.hw.price+'</span></div>';
    });
    html += '</div>';
  }

  d3.select('#pBody').html(html);
  panel.classed('open',true);
}

window._showHW = function(id) { var hw = HARDWARE.find(function(h){return h.id===id;}); if(hw) showHWPanel(hw); };

// ═══════════════════════════════════════════════════════════════════════════════
// OVERVIEW RENDER
// ═══════════════════════════════════════════════════════════════════════════════
function renderOverview(anim) {
  if(anim===undefined) anim=true;
  curView='overview'; curUC=null; updateBC();
  G.selectAll('*').remove();
  panel.classed('open',false);
  var cx=W/2, cy=H/2;

  // Spider web
  var web = G.append('g');
  var rings=[100,190,310,440];
  rings.forEach(function(r,i){
    web.append('circle').attr('cx',cx).attr('cy',cy).attr('r',r)
      .attr('fill','none').attr('stroke','rgba(124,106,255,0.05)').attr('stroke-width',.5)
      .attr('stroke-dasharray', i===0?'none':'4,8');
  });
  // Use case spokes
  USE_CASES.forEach(function(uc,i){
    var a = (i/USE_CASES.length)*Math.PI*2 - Math.PI/2;
    web.append('line').attr('x1',cx).attr('y1',cy)
      .attr('x2',cx+Math.cos(a)*480).attr('y2',cy+Math.sin(a)*480)
      .attr('stroke',uc.color+'0d').attr('stroke-width',1);
  });
  // Web polygon per ring
  rings.forEach(function(r){
    var pts = USE_CASES.map(function(_,i){
      var a = (i/USE_CASES.length)*Math.PI*2 - Math.PI/2;
      return [cx+Math.cos(a)*r, cy+Math.sin(a)*r];
    });
    web.append('path')
      .attr('d', d3.line().curve(d3.curveCardinalClosed.tension(.3))(pts))
      .attr('fill','none').attr('stroke','rgba(124,106,255,0.04)').attr('stroke-width',.5);
  });

  // Center
  var cNode = G.append('g').attr('transform','translate('+cx+','+cy+')').style('cursor','default');
  cNode.append('circle').attr('r',48).attr('fill','url(#cg)').attr('stroke','#7c6aff').attr('stroke-width',2).attr('stroke-opacity',.4);
  cNode.append('text').attr('text-anchor','middle').attr('dy','-6').attr('fill','#fff').attr('font-size','15px').attr('font-weight','700').text('LLM Picker');
  cNode.append('text').attr('text-anchor','middle').attr('dy','12').attr('fill','rgba(255,255,255,0.45)').attr('font-size','10px').text('497 Models \u00B7 11 Hardware');
  // Pulse
  cNode.append('circle').attr('r',48).attr('fill','none').attr('stroke','#7c6aff').attr('stroke-width',1).attr('stroke-opacity',0)
    .transition().duration(2000).ease(d3.easeLinear).attr('r',75).attr('stroke-opacity',.25)
    .transition().duration(1000).attr('r',90).attr('stroke-opacity',0)
    .on('end',function rp(){d3.select(this).attr('r',48).attr('stroke-opacity',0).transition().duration(2000).ease(d3.easeLinear).attr('r',75).attr('stroke-opacity',.25).transition().duration(1000).attr('r',90).attr('stroke-opacity',0).on('end',rp);});

  // Use case nodes (inner ring)
  var ucR = 175;
  USE_CASES.forEach(function(uc,i){
    var a = (i/USE_CASES.length)*Math.PI*2 - Math.PI/2;
    var x = cx+Math.cos(a)*ucR, y = cy+Math.sin(a)*ucR;

    G.append('line').attr('x1',cx).attr('y1',cy).attr('x2',x).attr('y2',y)
      .attr('stroke',uc.color).attr('stroke-width',1.5).attr('stroke-opacity',.12);

    var g = G.append('g').attr('transform','translate('+x+','+y+')')
      .attr('class','node-enter').style('animation-delay',i*70+'ms').style('cursor','pointer')
      .on('mouseover',function(e){ d3.select(this).select('.uc-r').attr('r',42); showTip(e,uc.label,uc.desc); })
      .on('mousemove',moveTip).on('mouseout',function(){ d3.select(this).select('.uc-r').attr('r',38); hideTip(); })
      .on('click',function(){renderUCView(uc);});

    g.append('circle').attr('class','uc-r').attr('r',38).attr('fill','url(#g-'+uc.id+')');
    g.append('circle').attr('r',40).attr('fill','none').attr('stroke',uc.color).attr('stroke-width',1.5).attr('stroke-opacity',.18);
    g.append('text').attr('text-anchor','middle').attr('dy','-4').attr('font-size','18px').text(uc.icon);
    g.append('text').attr('text-anchor','middle').attr('dy','16').attr('fill',uc.color).attr('font-size','9px').attr('font-weight','600').text(uc.label.toUpperCase());
  });

  // Hardware nodes (outer ring)
  var hwR = 380;
  HARDWARE.forEach(function(hw,i){
    var a = (i/HARDWARE.length)*Math.PI*2 - Math.PI/2 + .15;
    var x = cx+Math.cos(a)*hwR, y = cy+Math.sin(a)*hwR;
    var isFeatured = hw.featured;
    var rw = isFeatured ? 80 : 60;
    var rh = isFeatured ? 44 : 30;

    // Faint connections to use cases
    USE_CASES.forEach(function(uc,j){
      var ua = (j/USE_CASES.length)*Math.PI*2 - Math.PI/2;
      var ux = cx+Math.cos(ua)*ucR, uy = cy+Math.sin(ua)*ucR;
      var models = hw.models[uc.id]||[];
      if(models.length) G.insert('line',':first-child')
        .attr('x1',x).attr('y1',y).attr('x2',ux).attr('y2',uy)
        .attr('stroke',uc.color).attr('stroke-width',Math.min(1.5,models.length/2)).attr('stroke-opacity',.03).attr('stroke-dasharray','2,5');
    });

    var g = G.append('g').attr('transform','translate('+x+','+y+')')
      .attr('class','node-enter').style('animation-delay',(i*50+300)+'ms').style('cursor','pointer')
      .on('mouseover',function(e){ d3.select(this).select('rect').attr('stroke-opacity',.6); showTip(e,hw.label+' '+hw.price, hw.total+' compatible models \u00B7 '+hw.backend); })
      .on('mousemove',moveTip).on('mouseout',function(){ d3.select(this).select('rect').attr('stroke-opacity',isFeatured?.4:.15); hideTip(); })
      .on('click',function(){showHWPanel(hw);});

    if(isFeatured) {
      g.append('rect').attr('x',-rw/2-4).attr('y',-rh/2-4).attr('width',rw+8).attr('height',rh+8).attr('rx',12)
        .attr('fill','none').attr('stroke','#76b900').attr('stroke-width',1).attr('stroke-opacity',.15)
        .attr('filter','url(#glow)');
    }

    g.append('rect').attr('x',-rw/2).attr('y',-rh/2).attr('width',rw).attr('height',rh).attr('rx',isFeatured?10:7)
      .attr('fill',isFeatured?'rgba(118,185,0,0.08)':'rgba(10,10,15,0.85)')
      .attr('stroke',hw.color).attr('stroke-width',isFeatured?1.5:1).attr('stroke-opacity',isFeatured?.4:.15);

    g.append('text').attr('text-anchor','middle').attr('dy', isFeatured?'-4':'0')
      .attr('font-size', isFeatured?'10px':'8px').attr('font-weight','600').attr('fill',hw.color).attr('fill-opacity',isFeatured?1:.7)
      .text(hw.label.length>14?hw.label.slice(0,13)+'\u2026':hw.label);

    if(isFeatured) {
      g.append('text').attr('text-anchor','middle').attr('dy','10')
        .attr('font-size','9px').attr('font-weight','600').attr('fill','var(--amazon)').attr('fill-opacity',.8)
        .text(hw.price);
    }

    // Model satellite dots
    var topModels = (hw.models.coding||[]).slice(0,2).concat((hw.models.reasoning||[]).slice(0,1));
    topModels.forEach(function(m,j){
      var ma = a + ((j-1)/3)*.5;
      var md = hwR + 40 + j*14;
      var mx = cx+Math.cos(ma)*md, my = cy+Math.sin(ma)*md;
      G.append('line').attr('x1',x).attr('y1',y).attr('x2',mx).attr('y2',my)
        .attr('stroke',hw.color).attr('stroke-width',.3).attr('stroke-opacity',.06);
      var mg = G.append('g').attr('transform','translate('+mx+','+my+')')
        .attr('class','node-enter').style('animation-delay',((i*3+j)*30+500)+'ms').style('cursor','pointer')
        .on('mouseover',function(e){ d3.select(this).select('circle').attr('r',5); showTip(e,m.name,m.params+' \u00B7 '+m.ram+'GB \u00B7 '+m.toks+' t/s'); })
        .on('mousemove',moveTip).on('mouseout',function(){ d3.select(this).select('circle').attr('r',3); hideTip(); })
        .on('click',function(){showModelPanel(m,hw);});
      mg.append('circle').attr('r',3).attr('fill',hw.color).attr('fill-opacity',.35);
    });
  });

  if(anim) svg.transition().duration(700).call(zoom.transform, d3.zoomIdentity);
}

// ═══════════════════════════════════════════════════════════════════════════════
// USE CASE DRILL-DOWN
// ═══════════════════════════════════════════════════════════════════════════════
function renderUCView(uc) {
  curView='usecase'; curUC=uc; updateBC();
  G.selectAll('*').remove();
  showUCPanel(uc);

  var cx=W/2, cy=H/2;

  // Web bg
  [90,170,280,400].forEach(function(r){
    G.append('circle').attr('cx',cx).attr('cy',cy).attr('r',r).attr('fill','none').attr('stroke',uc.color+'08').attr('stroke-width',.5);
  });

  // Center
  var cg = G.append('g').attr('transform','translate('+cx+','+cy+')');
  cg.append('circle').attr('r',52).attr('fill','url(#g-'+uc.id+')');
  cg.append('circle').attr('r',52).attr('fill','none').attr('stroke',uc.color).attr('stroke-width',2).attr('stroke-opacity',.35);
  cg.append('text').attr('text-anchor','middle').attr('dy','-8').attr('font-size','22px').text(uc.icon);
  cg.append('text').attr('text-anchor','middle').attr('dy','14').attr('fill',uc.color).attr('font-size','11px').attr('font-weight','700').text(uc.label);

  // Hardware nodes arranged around center with their models
  HARDWARE.forEach(function(hw,i){
    var a = (i/HARDWARE.length)*Math.PI*2 - Math.PI/2;
    var dist = 220;
    var x = cx+Math.cos(a)*dist, y = cy+Math.sin(a)*dist;
    var models = hw.models[uc.id]||[];
    var isFeatured = hw.featured;

    // Link to center
    G.append('line').attr('x1',cx).attr('y1',cy).attr('x2',x).attr('y2',y)
      .attr('stroke',uc.color).attr('stroke-width',1).attr('stroke-opacity',.08);

    var rw = isFeatured ? 76 : 58;
    var rh = isFeatured ? 48 : 36;
    var g = G.append('g').attr('transform','translate('+x+','+y+')')
      .attr('class','node-enter').style('animation-delay',i*60+'ms').style('cursor','pointer')
      .on('mouseover',function(e){ d3.select(this).select('rect').attr('stroke-opacity',.6); showTip(e,hw.label+' '+hw.price, models.length+' '+uc.label+' models \u00B7 '+hw.mem+'GB'); })
      .on('mousemove',moveTip).on('mouseout',function(){ d3.select(this).select('rect').attr('stroke-opacity',isFeatured?.35:.15); hideTip(); })
      .on('click',function(){showHWPanel(hw);});

    if(isFeatured) {
      g.append('rect').attr('x',-rw/2-3).attr('y',-rh/2-3).attr('width',rw+6).attr('height',rh+6).attr('rx',11)
        .attr('fill','none').attr('stroke','#76b900').attr('stroke-width',1).attr('stroke-opacity',.12).attr('filter','url(#glow)');
    }

    g.append('rect').attr('x',-rw/2).attr('y',-rh/2).attr('width',rw).attr('height',rh).attr('rx',isFeatured?9:7)
      .attr('fill',isFeatured?'rgba(118,185,0,0.06)':'rgba(10,10,15,0.85)')
      .attr('stroke',hw.color).attr('stroke-width',isFeatured?1.5:1).attr('stroke-opacity',isFeatured?.35:.15);
    g.append('text').attr('text-anchor','middle').attr('dy',isFeatured?'-6':'0')
      .attr('font-size',isFeatured?'9px':'8px').attr('font-weight','600').attr('fill',hw.color)
      .text(hw.label.length>13?hw.label.slice(0,12)+'\u2026':hw.label);
    if(isFeatured) {
      g.append('text').attr('text-anchor','middle').attr('dy','8')
        .attr('font-size','8px').attr('font-weight','600').attr('fill','var(--amazon)').attr('fill-opacity',.8)
        .text(hw.price);
    }
    // Count badge
    g.append('circle').attr('cx',rw/2-2).attr('cy',-rh/2+2).attr('r',10)
      .attr('fill','rgba(10,10,15,0.9)').attr('stroke',uc.color).attr('stroke-width',.8).attr('stroke-opacity',.3);
    g.append('text').attr('x',rw/2-2).attr('y',-rh/2+5)
      .attr('text-anchor','middle').attr('font-size','8px').attr('font-weight','600').attr('fill',uc.color)
      .text(models.length);

    // Model nodes
    models.forEach(function(m,j){
      var ma = a + ((j-(models.length-1)/2)/Math.max(models.length,2))*.7;
      var md = dist + 60 + Math.sqrt(m.ram)*6;
      var mx = cx+Math.cos(ma)*md, my = cy+Math.sin(ma)*md;
      var nodeR = Math.max(4, Math.min(14, Math.sqrt(m.ram)*1.8));

      G.append('line').attr('x1',x).attr('y1',y).attr('x2',mx).attr('y2',my)
        .attr('stroke',uc.color).attr('stroke-width',.4).attr('stroke-opacity',.05);

      var fitColor = m.fit>=90?'var(--fit-perfect)':m.fit>=75?'var(--fit-good)':m.fit>=60?'var(--fit-marginal)':'var(--fit-tight)';
      var mg = G.append('g').attr('transform','translate('+mx+','+my+')')
        .attr('class','node-enter').style('animation-delay',((i*3+j)*30+200)+'ms').style('cursor','pointer')
        .on('mouseover',function(e){ d3.select(this).select('.md').attr('r',nodeR+2).attr('fill-opacity',.85); d3.select(this).select('.ml').attr('opacity',.9); showTip(e,m.name,m.params+' \u00B7 '+m.ram+'GB \u00B7 Fit '+m.fit+'% \u00B7 '+m.toks+' t/s'); })
        .on('mousemove',moveTip)
        .on('mouseout',function(){ d3.select(this).select('.md').attr('r',nodeR).attr('fill-opacity',.5); d3.select(this).select('.ml').attr('opacity',.35); hideTip(); })
        .on('click',function(){showModelPanel(m,hw);});

      mg.append('circle').attr('class','md').attr('r',nodeR).attr('fill',uc.color).attr('fill-opacity',.5)
        .attr('stroke',uc.color).attr('stroke-width',.5).attr('stroke-opacity',.25);
      // Fit ring
      mg.append('circle').attr('r',nodeR+3).attr('fill','none').attr('stroke',fitColor).attr('stroke-width',.8).attr('stroke-opacity',.25)
        .attr('stroke-dasharray',(m.fit/100)*2*Math.PI*(nodeR+3)+' '+2*Math.PI*(nodeR+3));
      mg.append('text').attr('class','ml').attr('text-anchor','middle').attr('dy',nodeR+12)
        .attr('font-size','7px').attr('fill',uc.color).attr('opacity',.35)
        .text(m.name.length>18?m.name.slice(0,16)+'\u2026':m.name);
    });
  });

  svg.transition().duration(700).call(zoom.transform, d3.zoomIdentity.scale(.85).translate(W*.09,H*.09));
}

// ═══════════════════════════════════════════════════════════════════════════════
// BREADCRUMB
// ═══════════════════════════════════════════════════════════════════════════════
function updateBC() {
  var bc = d3.select('#breadcrumb').html('');
  bc.append('div').attr('class','bc-item'+(curView==='overview'?' cur':'')).text('Overview').on('click',function(){renderOverview();});
  if(curUC) {
    bc.append('div').attr('class','bc-sep').text('\u203A');
    bc.append('div').attr('class','bc-item cur').style('color',curUC.color).text(curUC.label);
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// SEARCH
// ═══════════════════════════════════════════════════════════════════════════════
d3.select('#searchInput').on('input',function(){
  var q = this.value.toLowerCase().trim();
  if(!q){ renderOverview(false); return; }

  var mHW = HARDWARE.filter(function(h){ return h.label.toLowerCase().indexOf(q)>=0||h.backend.toLowerCase().indexOf(q)>=0||h.tier.toLowerCase().indexOf(q)>=0; });
  var mUC = USE_CASES.filter(function(u){ return u.label.toLowerCase().indexOf(q)>=0||u.id.indexOf(q)>=0; });
  var mModels = ALL_MODELS.filter(function(m){ return m.name.toLowerCase().indexOf(q)>=0; });

  G.selectAll('*').remove(); panel.classed('open',false);
  var cx=W/2, cy=H/2;
  var all = [];
  mUC.forEach(function(u){all.push({t:'uc',d:u});});
  mHW.forEach(function(h){all.push({t:'hw',d:h});});
  mModels.slice(0,24).forEach(function(m){all.push({t:'m',d:m});});

  G.append('text').attr('x',cx).attr('y',cy-20).attr('text-anchor','middle').attr('fill','var(--text-dim)').attr('font-size','12px')
    .text(all.length+' results for "'+q+'"');

  all.forEach(function(item,i){
    var a=(i/Math.max(all.length,1))*Math.PI*2-Math.PI/2;
    var dist=80+i*14;
    var x=cx+Math.cos(a)*dist, y=cy+Math.sin(a)*dist;
    var g = G.append('g').attr('transform','translate('+x+','+y+')').style('cursor','pointer')
      .attr('class','node-enter').style('animation-delay',i*15+'ms');

    if(item.t==='uc'){
      g.append('circle').attr('r',22).attr('fill',item.d.color+'20').attr('stroke',item.d.color).attr('stroke-width',1);
      g.append('text').attr('text-anchor','middle').attr('dy','1').attr('font-size','14px').text(item.d.icon);
      g.on('click',function(){renderUCView(item.d);});
    } else if(item.t==='hw'){
      g.append('rect').attr('x',-32).attr('y',-14).attr('width',64).attr('height',28).attr('rx',6)
        .attr('fill','rgba(10,10,15,0.85)').attr('stroke',item.d.color).attr('stroke-width',1);
      g.append('text').attr('text-anchor','middle').attr('dy','1').attr('font-size','8px').attr('font-weight','500').attr('fill',item.d.color)
        .text(item.d.label.slice(0,12));
      g.on('click',function(){showHWPanel(item.d);});
    } else {
      g.append('circle').attr('r',6).attr('fill','var(--accent)').attr('fill-opacity',.4);
      g.append('text').attr('text-anchor','middle').attr('dy',16).attr('font-size','7px').attr('fill','var(--text-dim)')
        .text(item.d.name.slice(0,18));
      g.on('click',function(){showModelPanel(item.d);});
    }
  });
});

// ═══════════════════════════════════════════════════════════════════════════════
// CONTROLS & RESIZE
// ═══════════════════════════════════════════════════════════════════════════════
d3.select('#btnReset').on('click',function(){ d3.select('#searchInput').property('value',''); renderOverview(); });
window.addEventListener('resize',function(){
  var w=window.innerWidth,h=window.innerHeight;
  svg.attr('width',w).attr('height',h);
  if(curView==='overview') renderOverview(false); else if(curUC) renderUCView(curUC);
});

// ═══════════════════════════════════════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════════════════════════════════════
renderOverview();
</script>
</body>
</html>
